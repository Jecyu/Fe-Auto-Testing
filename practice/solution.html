<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>已有的解决方案 | 前端自动化测试</title>
    <meta name="description" content="Analysis vue.js deeply">
    <link rel="icon" href="/Fe-Auto-Testing/logo.png">
  <link rel="manifest" href="/Fe-Auto-Testing/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/Fe-Auto-Testing/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/Fe-Auto-Testing/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/Fe-Auto-Testing/assets/css/0.styles.3ae066cf.css" as="style"><link rel="preload" href="/Fe-Auto-Testing/assets/js/app.092a0afe.js" as="script"><link rel="preload" href="/Fe-Auto-Testing/assets/js/16.cd7414cf.js" as="script"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/10.2106dc5c.js"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/11.c60ed52a.js"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/12.9068df64.js"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/13.02765de5.js"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/14.526ade17.js"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/15.9f362ddf.js"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/17.7bed77b4.js"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/18.458df518.js"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/19.39a58d89.js"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/2.3a8ead68.js"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/20.70a7fc52.js"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/21.473e6975.js"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/3.b3f65018.js"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/4.09b9b62a.js"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/5.e11b96bb.js"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/6.19a7a933.js"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/7.9dc0e2dd.js"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/8.2689fee4.js"><link rel="prefetch" href="/Fe-Auto-Testing/assets/js/9.ec96d22d.js">
    <link rel="stylesheet" href="/Fe-Auto-Testing/assets/css/0.styles.3ae066cf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Fe-Auto-Testing/" class="home-link router-link-active"><!----> <span class="site-name">前端自动化测试</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/Jecyu/Fe-Auto-Testing/tree/master" target="_blank" rel="noopener noreferrer" class="nav-link external">
  配套例子
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/Jecyu/Fe-Auto-Testing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/Jecyu/Fe-Auto-Testing/tree/master" target="_blank" rel="noopener noreferrer" class="nav-link external">
  配套例子
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/Jecyu/Fe-Auto-Testing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>测试相关概念</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Fe-Auto-Testing/concepts/" class="sidebar-link">Introduction</a></li><li><a href="/Fe-Auto-Testing/concepts/reason.html" class="sidebar-link">为什么要测试</a></li><li><a href="/Fe-Auto-Testing/concepts/type.html" class="sidebar-link">测试类型</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>测试实战</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Fe-Auto-Testing/practice/" class="sidebar-link">Introduction</a></li><li><a href="/Fe-Auto-Testing/practice/solution.html" class="active sidebar-link">已有的解决方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Fe-Auto-Testing/practice/solution.html#断言库" class="sidebar-link">断言库</a></li><li class="sidebar-sub-header"><a href="/Fe-Auto-Testing/practice/solution.html#测试框架" class="sidebar-link">测试框架</a></li><li class="sidebar-sub-header"><a href="/Fe-Auto-Testing/practice/solution.html#测试运行工具：karma" class="sidebar-link">测试运行工具：karma</a></li><li class="sidebar-sub-header"><a href="/Fe-Auto-Testing/practice/solution.html#测试辅助工具：sinon" class="sidebar-link">测试辅助工具：Sinon</a></li><li class="sidebar-sub-header"><a href="/Fe-Auto-Testing/practice/solution.html#选择-jest-不选-mocha" class="sidebar-link">选择 Jest 不选 Mocha</a></li><li class="sidebar-sub-header"><a href="/Fe-Auto-Testing/practice/solution.html#测试用例的设计" class="sidebar-link">测试用例的设计</a></li><li class="sidebar-sub-header"><a href="/Fe-Auto-Testing/practice/solution.html#测试的步骤" class="sidebar-link">测试的步骤</a></li></ul></li><li><a href="/Fe-Auto-Testing/practice/mocha.html" class="sidebar-link">Mocha</a></li><li><a href="/Fe-Auto-Testing/practice/jest.html" class="sidebar-link">Jest</a></li><li><a href="/Fe-Auto-Testing/practice/vue.html" class="sidebar-link">测试 Vue.js 组件</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>持续集成自动化测试</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Fe-Auto-Testing/auto/" class="sidebar-link">Introduction</a></li><li><a href="/Fe-Auto-Testing/auto/travis-ci.html" class="sidebar-link">Travis CI</a></li><li><a href="/Fe-Auto-Testing/auto/jenkins.html" class="sidebar-link">Jenkins</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>扩展</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Fe-Auto-Testing/popularize/" class="sidebar-link">Introduction</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Troubleshooting</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Fe-Auto-Testing/tip/" class="sidebar-link">Introduction</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>参考资料</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Fe-Auto-Testing/refs/" class="sidebar-link">Introduction</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="已有的解决方案"><a href="#已有的解决方案" aria-hidden="true" class="header-anchor">#</a> 已有的解决方案</h1> <p>在以前，我也很难理解测试，觉得写测试也很难，现在优秀的测试工具很多，可以让我们马上就可以写测试了。先看下面流行的测试工具</p> <ul><li>测试框架：<strong>Mocha</strong>，<strong>Jest</strong>，Jesmine，Tape，Tyu，Ava</li> <li>测试运行工具：Karam</li> <li>断言库：Assert，Should，Chai</li> <li>测试辅助工具：Sinon</li> <li>测试覆盖率工具：Istanbul</li> <li>无头浏览器：puppeteer</li></ul> <h2 id="断言库"><a href="#断言库" aria-hidden="true" class="header-anchor">#</a> 断言库</h2> <p><strong>所谓“断言”，就是判定源码的实际执行结果与预期结果是否一致，如果不一致就抛出一个错误</strong>。这也是测试原则里说给一个清晰的期望值。所有的测试用例（it块）都应该含有一句或多句的断言。它是编写测试用例的关键。断言功能由断言库来实现。</p> <ul><li>assert
assert 模块是 Node 的内置模块，用于断言。</li> <li>should.js
should.js是个第三方断言库，常和Mocha联合使用。</li> <li>Chai
Chai是个断言库，常和Mocha结合使用。它有多种断言风格（assertion style）：assert， expect， should</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="测试框架"><a href="#测试框架" aria-hidden="true" class="header-anchor">#</a> 测试框架</h2> <h3 id="mocha"><a href="#mocha" aria-hidden="true" class="header-anchor">#</a> Mocha</h3> <p><a href="https://mochajs.org/" target="_blank" rel="noopener noreferrer">Mocha<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>即是测试框架，也是一个测试 runner，它主要用到 Node.js 环境，也可以用在浏览器端，不过得手动配置各种适配脚本。</p> <p>特点：灵活，可扩展性好，可配合不同的断言库实用，但是自身集成度不高。</p> <h3 id="jest"><a href="#jest" aria-hidden="true" class="header-anchor">#</a> Jest</h3> <p><a href="https://jestjs.io/zh-Hans/" target="_blank" rel="noopener noreferrer">Jest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一个基于 Node 的测试运行工具, 这意味着测试总是在 Node 环境中运行，而不是在真正的浏览器中。
Jest是一个“<strong>零配置</strong>”的前端测试工具，具有诸如模拟和代码覆盖之类的开箱即用特性，主要用于React和其他JavaScript框架。 我们团队对采用JEST做前端测试的结果非常满意。它提供了一种“零配置”的开发体验，并具备诸多开箱即用的功能，比如 Mock 和代码覆盖率等。你不仅可以将此测试框架应用于React.js应用程序，也可以应用于其他 JavaScript 框架。Jest 经常被炒作的功能之一是用户界面的快照测试。快照测试可以作为测试金字塔上层一个很好的补充，但请记住，单元测试仍然是坚实的基础。 引用自 <a href="https://www.thoughtworks.com/radar/languages-and-frameworks/jest" target="_blank" rel="noopener noreferrer">thoughtWorks<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="测试运行工具：karma"><a href="#测试运行工具：karma" aria-hidden="true" class="header-anchor">#</a> 测试运行工具：karma</h2> <p>这个框架我使用过的是结合 mocha。
对于前端而言，javaScript 和 node 就够了。所以 mocha 测试框架就够了。同时mocha也可以运行在浏览器上。对于mocha 而言，需要配置html，才能运行在各个浏览器上。配置 mocha 相对复杂，繁琐一点，所以我们选择框架是 karma + mocha；</p> <h2 id="测试辅助工具：sinon"><a href="#测试辅助工具：sinon" aria-hidden="true" class="header-anchor">#</a> 测试辅助工具：Sinon</h2> <p>Sinon 的工作本质是“替身”，测试替身用来替换测试中国呢的部分代码，使得测试复杂代码变得简单。在做单元测试时，我们会发现测试的很多方法会引用很多外部依赖的对象。例如：前端项目通常是用 ajax 去服务端请求数据，得到数据之后进一步作处理。但是做单元测试的时候通常不需要真的去请求服务端数据，不仅麻烦，可能服务端接口还没做好。这种不确定的依赖使得测试变复杂，所以我们需要用<code>Sinon</code>模拟这个请求数据的过程。</p> <h2 id="选择-jest-不选-mocha"><a href="#选择-jest-不选-mocha" aria-hidden="true" class="header-anchor">#</a> 选择 Jest 不选 Mocha</h2> <p>优点：</p> <ul><li>开箱即用，Mock（干掉 Sinon）、Test Runner（干掉 Karma）、Matcher（干掉 Chai）、Test -Coverage（内置 istanbul）</li> <li>Watch Mode 注重开发者体验，能够在编码的时候帮助我们快速获得测试结果的反馈。</li></ul> <p>具体对比：</p> <ol><li>jest 测试覆盖率时，针对 babel 或 webpack 编译后的文件，不需要额外处理对于 sourcemap 的处理。</li> <li>chai和sinon提供的断言API就不如jest友好，体现在：</li></ol> <ul><li>expect(array).to.eql(array)出错的时候，只能报告说expect [Array (42)] to - - - equal [Array (42)]，具体是哪个数据不匹配，根本没报告
expect(sinonStub.calledWith(args)).to.be.true出错的时候，会报告说expect false to be true。废话，我还不知道挂了么，但是那个stub究竟被什么参数调用则没有报告
From <code>it</code> to <code>expect</code> - Jest has the entire toolkit in one place. Well documented, well maintained, well good.</li></ul> <h2 id="测试用例的设计"><a href="#测试用例的设计" aria-hidden="true" class="header-anchor">#</a> 测试用例的设计</h2> <h3 id="两种写法"><a href="#两种写法" aria-hidden="true" class="header-anchor">#</a> 两种写法</h3> <p>测试框架通常提供 TDD（测试驱动开发）或 BDD（行为驱动开发）的测试语法来编写测试用例。不同的测试框架支持不同的测试语法，BDD 提供了可读性更好的测试用例语法，像读句子一样（需求人员也能看懂），让你更加专注于功能而不是结果。</p> <p><strong>测试驱动开发</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">suite</span><span class="token punctuation">(</span><span class="token string">'Test'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// Create any objects that we might need</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">suite</span><span class="token punctuation">(</span><span class="token string">'#factorial()'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'equals 1 for sets of zero length'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'equals 1 for sets of length one'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'equals 2 for sets of length two'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'equals 6 for sets of length three'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>行为驱动开发</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Test'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">before</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// Stuff to do before the tests, like imports, what not</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'#factorial()'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should return 1 when given 0'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>should<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should return 1 when given 1'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>should<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should return 2 when given 2'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>should<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should return 6 when given 3'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>should<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">after</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Anything after the tests have finished</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="黑盒测试和白盒测试"><a href="#黑盒测试和白盒测试" aria-hidden="true" class="header-anchor">#</a> 黑盒测试和白盒测试</h3> <h3 id="测试用例"><a href="#测试用例" aria-hidden="true" class="header-anchor">#</a> 测试用例</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'My first Test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'adds 1 + 1 to equal 2'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>首先我们看到的是一个由<code>it</code>包裹的测试主体最小单元，采用了<code>Given When Then</code>的经典格式，我们常常称之为测试三部曲，也可以解释为 3A 即：</p> <p>GWT3A说明<code>GivenArrange</code>准备测试测试数据，有时可以抽取到<code>beforeEachWhenAct</code>采取行动，一般来说就是调用相应的模块执行对应的函数或方法<code>ThenAssert</code>断言，这时需要借助的就是<code>Matchers</code>的能力，Jest还可以扩展自己的Matcher
在expect后面的toBe称之为 Matcher，是断言时的判断语句以验证正确性 ✅，在后面的文章中我们还会接触更多 Matchers，甚至可以扩展一些特别定制的 Matchers。</p> <h2 id="测试的步骤"><a href="#测试的步骤" aria-hidden="true" class="header-anchor">#</a> 测试的步骤</h2> <ul><li>Given</li> <li>When</li> <li>Then</li></ul> <ol><li>安装 Jest</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span> <span class="token function">add</span> jest --dev
</code></pre></div><ol start="2"><li>在 package.json 中配置测试脚本</li></ol> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --hot --open --config build/webpack.dev.config.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ol start="3"><li>首先我们针对下面的代码进行第一个单元测试，它没有调用任何其他的函数，简单的输入和输出。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 输出文字</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">generateText</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> years old)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li>创建一个 test 目录放置 test 脚本文件，这里放入 <code>base.spec.js</code>，jest 会自动检测这个文件</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 第一个参数写测试的功能组描述 </span>
<span class="token comment">// 第二个参数，添加测试代码</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'应该输出 name 和 age'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token function">generateText</span><span class="token punctuation">(</span><span class="token string">'Jecyu'</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 对比手动测试，需要到浏览器点击</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'Jecyu (25 years old)'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="5"><li>然后我们清晰地看到输出
<img src="/Fe-Auto-Testing/assets/test-terminal-log.png"></li> <li>在说到<strong>集成测试</strong>时，我们作下处理,</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">generateText</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// return `${name} (${age} years old)`;</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Jecyu (25 years old)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>并且添加第二个测试，但它总是成功的了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'应该输出空文本'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token function">generateText</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">' ( years old) '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="7"><li>现在修复刚刚的更改，第二个测试却报错了</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">generateText</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> years old)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-yml extra-class"><pre class="language-text"><code>Expected: &quot; ( years old) &quot;
    Received: &quot; (null years old)&quot;
</code></pre></div><h3 id="集成测试"><a href="#集成测试" aria-hidden="true" class="header-anchor">#</a> 集成测试</h3> <p>可以看到这里选择了几个元素，对输入作验证，然后生成文本。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">addUser</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 基于用户的输入数据，创建一个新的 HTML 元素</span>
  <span class="token comment">// 添加到 DOM 树中</span>
  <span class="token keyword">const</span> newUserNameInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'input#name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> newUserAgeInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'input#age'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    <span class="token operator">!</span><span class="token function">validateInput</span><span class="token punctuation">(</span>newUserNameInput<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">||</span>
    <span class="token operator">!</span><span class="token function">validateInput</span><span class="token punctuation">(</span>newUserAgeInput<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> userList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.user-list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> outputText <span class="token operator">=</span> <span class="token function">generateText</span><span class="token punctuation">(</span>newUserNameInput<span class="token punctuation">.</span>value<span class="token punctuation">,</span> newUserAgeInput<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> outputText<span class="token punctuation">,</span> <span class="token string">'user-item'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  userList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这里的验证输入函数已经抽离出来，现在可以新建一个函数，集成验证输入和生成文本两个功能。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 验证和生成</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">checkAndGenerate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
    <span class="token operator">!</span><span class="token function">validateInput</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">||</span>
    <span class="token operator">!</span><span class="token function">validateInput</span><span class="token punctuation">(</span>age<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">generateText</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试文件，对源文件作任何改变，这里都能快速反馈</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'应该输出一个有效的文本'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token function">checkAndGenerate</span><span class="token punctuation">(</span><span class="token string">'Jecyu'</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这个函数集成了两个函数</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'Jecyu (25 years old)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>即使单元测试的函数正常运行，但是集成后的逻辑出现错误，一样会运行失败，因此集成测试是需要的。</p> <h3 id="端到端测试"><a href="#端到端测试" aria-hidden="true" class="header-anchor">#</a> 端到端测试</h3> <p>addUser 的依赖很多，适合端到端的测试。现在我们需要安装另外一个工具 <a href="https://pptr.dev/" target="_blank" rel="noopener noreferrer">puppeteer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span> <span class="token function">add</span> puppeter --dev 
</code></pre></div><p>首先我们需要创建一个浏览器实例，打开页面，然后实用 puppeteer 的 API 操作它们。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'应该正常点击'</span><span class="token punctuation">,</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>   
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    headless<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    slowMo<span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span>  <span class="token comment">// 可以让我们观察到操作</span>
    args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'--window-size=1920, 1080'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 按照指定路径进行测试</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'http://localhost:9000/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'input#name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'input#name'</span><span class="token punctuation">,</span> <span class="token string">'Jecyu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输入</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'input#age'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'input#age'</span><span class="token punctuation">,</span> <span class="token string">'25'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输入，这里要输入字符串形式 https://github.com/GoogleChrome/puppeteer/issues/2266</span>
  <span class="token comment">// 进行点击</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'button#btnAddUser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 检测是否生成指定样式的项目</span>
  <span class="token keyword">const</span> finalText <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token string">'.user-item'</span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">.</span><span class="token function">textContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>finalText<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'Jecyu (25 years old)'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
运行测试，可能会出现测试超时的报错，这个时候可以使用钩子函数设置指定超时时间。
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>`bash
Timeout <span class="token operator">-</span> Async callback was not invoked within the <span class="token number">5000</span>ms timeout specified by jest<span class="token punctuation">.</span>setTimeout<span class="token punctuation">.</span>Error<span class="token punctuation">:</span>
</code></pre></div><p>延长测试时间</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// 在每个测试用例跑之前运行</span>
  jest<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置 jest 测试超时时间</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> 
</code></pre></div><p>之后会有第二个异步导致的警告</p> <div class="language-bash extra-class"><pre class="language-bash"><code>Jest did not <span class="token builtin class-name">exit</span> one second after the <span class="token builtin class-name">test</span> run has completed.
This usually means that there are asynchronous operations that weren't stopped <span class="token keyword">in</span> your tests. Consider running Jest with <span class="token variable"><span class="token variable">`</span>--detectOpenHandles<span class="token variable">`</span></span> to troubleshoot this issue.
</code></pre></div><p>解决：关闭浏览器即可</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 关闭连接</span>
<span class="token function">afterAll</span><span class="token punctuation">(</span> <span class="token keyword">async</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/Jecyu/Fe-Auto-Testing/edit/master/docs/practice/solution.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">7/1/2020, 5:54:23 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/Fe-Auto-Testing/practice/" class="prev router-link-active">
          Introduction
        </a></span> <span class="next"><a href="/Fe-Auto-Testing/practice/mocha.html">
          Mocha
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/Fe-Auto-Testing/assets/js/app.092a0afe.js" defer></script><script src="/Fe-Auto-Testing/assets/js/16.cd7414cf.js" defer></script>
  </body>
</html>
